# Meta-analysis {#meta}

<!-- NC: May need to remind the reader that we are using SMD as the effect size -->


```{r meta-initialization}
#--------------------------------------------------------------------------------
# Paluck et al. meta-analysis
# Note: I cannot perfectly reproduce their results
#--------------------------------------------------------------------------------
library("tidyverse")
library("metafor")
library("MetaUtility")
library("PublicationBias")

# rounding digits
digits = 2

# helper fn taken from https://osf.io/ue36m/
sim_data2 = function(p,
                     keep.all.studies = FALSE) {

  N = p$k * p$per.cluster

  # generate cluster random intercepts
  # called "zeta" in paper
  # these are normal even when true effect dist is exponential
  gam1 = rnorm( n = p$k, mean = 0, sd = sqrt( p$V.gam ) )
  gam1i = rep( gam1, each = p$per.cluster )

  # generate individual-study random intercepts
  # these are called "gamma" in the paper
  # these are either normal or exponential
  if ( p$true.dist == "norm" ) gam2i = rnorm( n = N, mean = 0, sd = sqrt( p$V - p$V.gam ) )

    if ( p$true.dist == "exp" ) {
      true.effect.var = p$V - p$V.gam
      # set var using properties of exponential
      gam2i = rexp( n = N, rate = true.effect.var^(-1/2) )
      # shift to have mean of 0
      # use fact that var = mean^2 in exponential
      gam2i = gam2i - true.effect.var^(1/2)
    }


  # individual study SEs
  sei = runif( n = N, min = p$sei.min, max = p$sei.max )

  # individual study means
  if ( p$SE.corr == TRUE ) {
    beta = 6
    mui = p$mu + beta * sei + gam1i + gam2i

    # recenter them to have desired mean of p$mu
    # because E[sei}]
    mui = mui - beta * mean(sei)

    cor(sei, mui)
  } else {
    mui = p$mu + gam1i + gam2i
  }

  # individual study point estimates
  yi = rnorm( n = N, mean = mui, sd = sei )

  # NEW: make cluster variable
  # this way, if we generate (say) 5 studies per "cluster", but V.gam = 0 in order
  #  to effectively generate without clustering, the cluster variable we ultimately
  #  pass to robumeta correctly reflects the lack of clustering
  if ( p$V.gam == 0 ) cluster = 1:N else cluster = rep(1:p$k, each = p$per.cluster)
  
  # suppress warnings from cor if SD of mui is 0 (fixed-effects model)
  d = suppressWarnings( data.frame( cluster = cluster,
                                    Study.name = 1:N,
                                    mui,
                                    yi = yi,
                                    sei = sei,
                                    vi = sei^2,
                                    pval = 2 * ( 1 - pnorm( abs(yi) / sei ) ),
                                    SE.corr.emp = cor(sei, mui) ) )  # empirical correlation
  
  # 1-tailed publication bias
  signif = d$pval < 0.05 & d$yi > 0
  publish = rep( 1, nrow(d) )
  publish[ signif == FALSE ] = rbinom( n = sum(signif == FALSE), size = 1, prob = 1/p$eta )

  d$weight = 1
  d$weight[ signif == 0 ] = p$eta

  # optionally, also select for small SE
  # Fi as defined in Supplement
  # tertiles of empirical SEs prior to selection
  Fi = rep( 1, nrow(d) )  # so that it has no effect if we're not selecting based on SE
  if ( p$select.SE == TRUE ) {
    terts = p$sei.min + (p$sei.max - p$sei.min) * c(1/3, 2/3)
    # prob of inclusion based on SE
    P.Fi = rep(NA, nrow(d))
    P.Fi[ d$sei < terts[1] ] = 1
    #Fi[ d$sei >= terts[1] ] = 0
    P.Fi[ d$sei >= terts[1] & d$sei < terts[2] ] = .75
    P.Fi[ d$sei >= terts[2] ] = .5
    Fi = rbinom( n = nrow(d),
                 size = 1,
                 prob = P.Fi )
  }

  if ( keep.all.studies == FALSE ) d = d[ publish == 1 & Fi == 1, ]
  if ( keep.all.studies == TRUE ){
    # just add the indicators
    d$publish = publish
    d$Fi = Fi
  }

  # record the mean empirical SE (after publication bias) as sanity check on SE selection
  # but avoid errors if d now has 0 studies
  if ( nrow(d) > 0 ) {
    d$SE.mean.emp = mean(d$sei)
    d$P.select.SE.emp = mean(Fi)
    d$P.publish.emp = mean(publish)
    return(d)
  } else {
    # still return the empty dataset for use in doParallel
    return(d)
  }
}
```

```{r meta-paluck}  
DF <- read.csv("data/Contact_quant_outcomes.csv")


# remove supplemental studies (see Paluck et al. Supplement Section 1)
DF <- DF[1:27, ]

# calculate total n and determine whether d estimate was significant
DF <- DF %>% 
  
  rowwise() %>% 
  
  # calculate total n
  mutate(n_total = n_t + n_c) %>% 
  
  # determine whether d estimate was significant
    ## calculate lower and upper bounds
    mutate(lb = d - (1.96 * sqrt(var_d)),
           ub = d + (1.96 * sqrt(var_d))) %>% 
    
    ## determine significance
    mutate(sig = if_else(
      condition = lb > 0,
      true = 1,
      false = 0)) %>% 
  
  ungroup() %>% 
  
  # MM likes it ordered by variance for forest plot prettiness
  arrange(var_d)

# fixed effect meta
fe.m <- rma(yi = d,
            vi = var_d,
            data = DF,
            method = "FE")

# random effect meta
re.m <- rma(yi = d,
            vi = var_d,
            data = DF,
            method = "REML",
            knha = TRUE,
            # for forest plot joy:
            slab = DF$name_short)

# estimated heterogeneity with inference
t2.CI = tau_CI(meta = re.m)
tauStats = round( c( sqrt(re.m$tau2), t2.CI[1], t2.CI[2] ), digits )

```

::: learning-goals
🍎 Learning goals:

- Understand the benefits of synthesizing evidence across studies.
- Understand the pitfalls of intuitive approaches to evidence synthesis, with a focus on how many of these issues are addressed via meta-analysis.
- Conduct a simple fixed- or random-effects meta analysis.
- Understand that within- and across-study biases affect not only individual studies, but also meta-analysis. 
:::

::: case-study
🔬 Case study: Hotel towel reuse (Scheibehenne, Jamil, and Wagenmakers 2016). A simple example of aggregating noisy evidence from replications.

In a widely-cited study on the power of describing social norms, @goldstein2008room examined the effect of social norm messaging on hotel towel reuse. Across two studies, they found that guests were significantly more likely to reuse their towels after receiving a social norm message that stated most other people reuse their towels (Study 1 $p = .05$, Study 2 $p = .03$). However, five subsequent studies consistently failed to indicate that social norm messages increased hotel towel reuse (all $p > .05$).

At first glance, you might conclude that these studies indicate that social norm messages do not reliably impact towel reuse. You might even go a step further and try to think of explanations for why one team found the effect, but others did not. (Maybe the messages change behavior when guest receive nice fluffy towels, but not when they  receive cheap, low-quality towels.) However, this is a case where binary thinking about $p$-values can mislead us. When @scheibehenne2016 combined the evidence via a *meta-analysis*, they found that the results across these studies were, for the most part, quite consistent. Participants who received a social norm message were slightly more likely to reuse their towels in four out of five of the studies--but most of the studies simply did not have large enough samples for this difference to be statistically significant. When combined, however, meta-analysis indicated that social norm messages did have a significant overall effect on hotel towel reuse.
:::

When students hear the term "review", they often have flashbacks to times where they threw some search term into Google Scholar, downloaded a bunch of articles that looked interesting, spent a few days reading those articles, and then wrote a summary of what they learned. This is one of many ways of performing a review (see @grant2009typology), but this chapter focuses on a specific type of quantitative review called *meta-analysis*.

One of the central parts of the meta-analysis is extracting *effect sizes* from individual studies and then combining these effect sizes. (Feel free to check back to Chapter \@ref(estimation) if you need a refresher on effect sizes. We'll wait here for you, we promise.) By combining information from multiple studies, meta-analysis often provides more precise estimates of an effect size than any single study. In addition, meta-analysis also allows the researcher to look at the extent to which an effect varies  across studies. If an effect does vary across studies, meta-analysis can be used to test whether certain study characteristics systematically produce different results (e.g., whether an effect is larger in certain world regions).

Meta-analysis often teaches us something about a body of evidence that we do not intuitively grasp when we casually read through a bunch of articles. Indeed, in the above case study, merely reading all the studies that tested the effect of social norm messaging on hotel towel re-use would give the impression that the effect is (at best) unreliable. However, meta-analysis indicated that the results across studies are not as inconsistent as they seem--and that social norm messaging did decrease towel re-use overall. Given the number of hotel bookings worldwide--1.7 billion in the European Union alone in 2013 @kotzeva2015eurostat--the unique insight provided by the meta-analysis is not at all trivial!

The hotel towel example is a good starting point but there is much more we can do with meta-analysis. To illustrate, we'll turn to another example: a meta-analysis of an idea called the *contact hypothesis*. According to contact hypothesis, prejudice can be reduced when members of majority and minority groups come together in the pursuit of a common goal @allport1954nature. To examine whether this type of intergroup contact can mitigate prejudice in the real world, @paluck2019contact performed a meta-analysis of studies that tested the effects of randomly-assigned intergroup contact interventions on prejudice-related outcomes. Cohen's $d$--which, if you recall from Chapter \@ref(estimation), represents the standardized mean difference--was used as the effect size index. As we show in the remainder of the chapter, the meta-analytic tools @paluck2019contact used provide several useful insights about this proposed prejudice-reduction intervention.

## The basics of evidence synthesis

### How *not* to synthesize evidence

When considering evidence across multiple studies, many people intuitively count how many studies supported versus did not support the hypothesis under investigation. This usually amounts to counting the number of studies with "significant" $p$-values, since (for better or for worse) "significance" is largely what drives the take-home conclusions researchers report [@mcshane2017statistical; @nelson1986interpretation]. In meta-analysis, we call this practice of counting the number of significant $p$-values *vote-counting* [@borenstein2021introduction]. For example, in the @paluck2019contact meta-analysis, all studies yielded positive effect sizes, but only approximately `r sum(DF$sig)` of `r nrow(DF)` were significant. So, based on this vote-count, we would have the impression that most studies do not support the contact hypothesis.

Many literature reviews use this vote-counting approach--albeit often not explicitly. Despite its intuitive appeal, though, vote-counting can be very misleading because it characterizes evidence solely in terms of dichotomized $p$-values, while entirely ignoring effect sizes. In Chapter \@ref(replication), we saw how this fetishism of statistical significance can mislead us when we consider individual studies. These problems propagate to evidence syntheses if we simply vote-count statistical significance across studies as well. For example, small studies on large effects may consistently produce non-significant effects that, when combined in a large meta-analysis, provide strong evidence of an effect. Inversely, it is also possible for a meta-analysis to not provide strong evidence of an effect despite several studies finding statistically significant effect size estimates. In these cases, vote-counting could lead us badly astray [@borenstein2021introduction]. To avoid these pitfalls, meta-analysis combines the effect sizes estimates from each study.


### Combining results across studies using fixed-effect meta-analysis

Once you are ready to combine results across studies, you have to figure out how you will do so. A seemingly reasonable approach would be to simply average the effect size estimates from each study. For example, in Paluck et al.'s meta-analysis, the mean of the studies' effect size estimates is `r round( mean(DF$d), digits )`. This approach is a step in the right direction, but it has an important limitation. Specifically, simply averaging effect size estimates gives equal weight to each study. A small study (like @clunies1989changing, with a sample size of `r DF[1, ]$n_total`) contributes as much to the mean effect size as a large study (like @boisjoly2006empathy, with a sample size of `r DF[27, ]$n_total`). This is problematic--as we know that larger studies typically provide more accurate estimates of effect sizes. Thus, larger studies should carry more weight in the analysis. This brings us to a common approach to principled evidence synthesis, *fixed-effect meta-analysis*.

<!-- NC: I'm not really sure if this forest plot adds much to the explanation. As is, I worry that it may confuse more than it informs  -->
As we've seen throughout this book, visualizing data before and after analysis helps benchmark and sanity-check our intuitions about the formal statistical results. In a meta-analysis, a common way to do so is the **forest plot**, which depicts individual studies' estimates and confidence intervals. (You can ignore for now the column of percentages and the final line, "RE Model"; we will return to these later.) In this plot, the larger squares correspond to more precise studies; notice how much narrower their confidence intervals are than the confidence intervals of less precise studies.


```{r meta-forest, fig.cap="Forest plot for Paluck et al. meta-analysis. Studies are ordered from smallest to largest standard error."}
metafor::forest(re.m,
       showweights = TRUE,
       header = TRUE,
       xlab = "Standardized mean difference")
```

Fixed-effect meta-analysis uses a *weighted-average*, wherein larger, more precise studies are given more weight in the calculation of the overall effect size. Specifically, studies are weighed by the inverse of their variance (i.e., the inverse of their squared standard error). This makes sense because larger, more precise studies have smaller variances, and thus get more weight in the analysis. The fixed-effect pooled estimate is:

$$\widehat{\mu} = \frac{ \sum_{i=1}^k w_i \widehat{\theta}_i}{\sum_{i=1}^k w_i}$$ where $k$ is the number of studies, $\widehat{\theta}_i$ is the point estimate of the $i^{th}$ study, and $w_i = 1/\widehat{\sigma}^2_i$ is study $i$'s weight in the analysis (i.e., the inverse of its variance).[^9]

In Paluck et al.'s meta-analysis, we would calculate the fixed-effect estimate, $\widehat{\mu}$, as:

<!-- hard-coded from DF$d[1:2] and DF$se_d[1:2] -->
$$\widehat{\mu} = \frac{ \frac{\widehat{\theta}_{study1}}{\widehat{\sigma}^2_{study1}} + \frac{\widehat{\theta}_{study2}}{\widehat{\sigma}^2_{study2}} + \cdots}{ \frac{1}{\widehat{\sigma}^2_{study1}} + \frac{1}{\widehat{\sigma}^2_{study2}} + \cdots } =
\frac{ \frac{0.03}{0.08^2} + \frac{0.30}{0.08^2} + \cdots }{ \frac{1}{0.08^2} + \frac{1}{0.08^2} + \cdots }$$

We thus estimate that the overall effect size in these studies is a standardized mean difference of $\widehat{\mu}$ = `r round(as.numeric(fe.m$b), 2)`; 95% confidence interval [`r paste0(round(fe.m$ci.lb, 2), ", ", round(fe.m$ci.ub, 2))`]; $p=$ < .001. Because cohen's $d$ is our effect size index, this means that intergroup contact decreased prejudice by `r round(as.numeric(fe.m$b), 2)` standard deviations.


[^9]: If you are curious, the standard error of the fixed-effect $\widehat{\mu}$ is $\frac{1}{\sum_{i=1}^k w_i}$. This can be used to construct a confidence interval or $p$-value.


### Limitations of fixed-effects meta-analysis

One of the limitations of fixed-effect meta-analysis is that it assumes that the true effect size is, well, *fixed* across studies. In other words, fixed-effect meta-analysis assumes that there is a single effect size that all studies are estimating. This is a bold assumption. For example, imagine that intergroup contact (a) decreases prejudice when the groups succeed at their goal, but (b) increases prejudice when the groups fail at their goal.  If we combined one study that had intergroups fail at their goal with another study that had intergroups succeed at their goal, it would appear that the true effect of intergroup contact is zero. However, is it reasonable to assume that these studies are examining the same fixed effect? Is it perhaps more useful to think of the *multiple* effects of intergroup contact (e.g., one effect for intergroup success and one effect for intergroup failure?) 

In Paluck et al.'s meta-analysis, studies differed in several ways that could lead to different true effects. For example, some studies recruited adult participants while others recruited children. If we assume that intergroup contact works different for adults vs. children, then it is misleading to talk about a single intergroup contact effect. Instead, we would say that the effects of intergroup contact varies across studies: an idea called **heterogeneity**.

Does this presence of heterogeneity remind you of anything from when we analyzed repeated-measures data in Chapter \@ref(models) on models? Recall that, with repeated-measures data, we had dealt with the possibility of heterogeneity across participants by introducing participant-level random intercepts to our regression model. Turns out that we can do a similar thing in meta-analysis!

### Random-effects meta-analysis

Whereas fixed-effect meta-analysis essentially assumes that all studies in the meta-analysis have the same population effect size, $\mu$, random-effects meta-analysis instead postulates that studies' population effects come from a normal distribution with mean $\mu$ and standard deviation $\tau$.[^10] The larger the standard deviation, $\tau$, the more heterogeneous the effects are across studies. A random-effects model then estimates both $\mu$ and $\tau$, for example by maximum likelihood (@dersimonian1986meta; @brockwell2001comparison).[^11]

[^10]: Technically, other specifications of random-effects meta-analysis are possible. For example, robust variance estimation does not require making assumptions about the distribution of effects across studies [@hedges2010robust]. These approaches also have other substantial advantages, like their ability to handle effects that are clustered (e.g., because some papers contribute multiple estimates; [@hedges2010robust]; [@pustejovsky2021meta]) and their ability to provide better inference in meta-analyses with relatively few studies [@tipton2015small]. For these reasons, we tend to use these methods by default when conducting meta-analyses.

[^11]: A confidence interval and $p$-value for the random-effects estimate $\widehat{\mu}$ can be obtained using standard theory for maximum likelihood estimates with an additional adjustment that helps account for uncertainty in estimating $\tau$ [@knapp2003improved].


Like fixed-effect meta-analysis, the random-effects estimate of $\widehat{\mu}$ is still a weighted average of studies' effect size estimates: $$\widehat{\mu} = \frac{ \sum_{i=1}^k w_i \widehat{\theta}_i}{\sum_{i=1}^k w_i}$$

However, in random-effects meta-analysis, the inverse-variance weights now incorporate heterogeneity: $w_i = 1/\left(\widehat{\tau}^2 + \widehat{\sigma}^2_i \right)$. These weights represent the inverse of studies' *marginal* variances, comprising not only statistical error due to their finite sample sizes ($\widehat{\sigma}^2_i$) but also genuine effect heterogeneity ($\widehat{\tau}^2$).[^12]

[^12]: The estimate of $\widehat{\tau}^2$ is a bit more complicated, but is essentially a weighted average of studies' residuals, $\widehat{\theta_i} - \widehat{\mu}$, while subtracting away variation due to statistical error, $\widehat{\sigma}^2_i$ [@dersimonian1986meta; @brockwell2001comparison].

### Reporting on heterogeneity

Remember that in random-effects meta-analysis, the estimate $\widehat{\mu}$ represents only the *mean* population effect across studies. It tells us nothing about how much the effects *vary* across studies. Thus, we recommend always reporting the heterogeneity estimate $\widehat{\tau}$, perhaps supplemented by other related metrics (@riley2011interpretation; @wang2019simple; @mathur_mam; @npphat). Reporting the heterogeneity indicates how consistent or inconsistent the effects are across studies, which may point to the need to investigate *moderators* of the effect (i.e., factors that can cause a shift in the size of the effect, such as the type of intergroup contact intervention).[^13]

[^13]: One common approach to investigating moderators in meta-analysis is meta-regression, in which moderators (e.g., type of intergroup contact) are included as covariates in a random-effects meta-analysis model [@thompson2002should]. As in standard regression, coefficients can then be estimated for each moderator, representing the mean difference in population effect between studies with versus without the moderator.

### Applied example

Conducting a random-effects meta-analysis of Paluck et al.'s dataset yields $\widehat{\mu}$ = `r round(as.numeric(re.m$b), 2)` ; 95% confidence interval [ `r paste0(round(re.m$ci.lb, 2), ", ", round(re.m$ci.ub, 2))` ]; $p=$ < .001. That is, they estimated that, *on average across studies*, intergroup contact was associated with a decrease in prejudice of `r round(as.numeric(re.m$b), 2)` standard deviations. However, these effects appeared to differ considerably across studies; they estimated that the standard deviation of effects across studies was $\widehat{\tau}$ = `r tauStats[1]` ; 95% confidence interval [`r tauStats[2]`, `r tauStats[3]`]. To conveniently visualize these results, we can plot the estimated density of the population effects, which is just a normal distribution with mean $\widehat{\mu}$ and standard deviation $\widehat{\tau}$. 


```{r meta-densities, fig.margin = TRUE, fig.cap= "Estimated distribution of population effects from random-effects meta-analysis of Paluck et. al's dataset (heavy red curve) and estimated density of studies' point estimates (thin black curve)."}
# red line: fitted density of *population* effects from meta-analysis
# gray line: just a dumb density estimate from the *point estimates*
library(ggplot2)

ggplot(data = data.frame(x = c(-2, 2)),
       aes(x)) +
  
  # reference lines
  geom_vline(xintercept = 0,
             lwd = 1,
             color = "gray") +
  
  geom_vline(xintercept = re.m$b,
             lty = 2,
             lwd = 1,
             color = "red"
  ) +
  
  # estimated density of estimates (nonparametric)
  geom_density( data = DF,
                aes(x = d),
                adjust = 1.2 ) +
  
  # estimated density from meta-analysis (parametric)
  stat_function( fun = dnorm,
                 n = 101,
                 args = list( mean = re.m$b,
                              sd = sqrt(re.m$tau2) ),
                 lwd = 1.2,
                 color = "red") +

  ylab("") +
  scale_x_continuous( breaks = seq(-2, 2, 0.5)) +
  xlab("Standardized mean difference") +
  theme_minimal() +
  scale_y_continuous(breaks = NULL) +
  theme(text = element_text(size=16),
        axis.text.x = element_text(size=16))
```


## Bias in meta-analysis

Meta-analysis is an invaluable tool to synthesize evidence across studies. However, meta-analyses can be compromised by two categories of bias: *within-study biases* and *across-study biases*. Either type of bias can lead to meta-analysis estimates that are too large, too small, or in the wrong direction. We will now discuss examples of each type of bias. We will also discuss ways to address these biases when conducting a meta-analysis, including mitigating the biases at the outset through sound meta-analysis design and also assessing the robustness of the ultimate conclusions to possible remaining bias.

### Within-study biases

Within-study biases--such as demand characteristics, confounds, and order effects--not only impact the validity of individual studies, but also any attempt to synthesize those studies. In other words: garbage in, garbage out. For example, @paluck2019contact noted that early studies on intergroup contact almost exclusively used nonrandomized designs. Imagine a hypothetical study where researchers (a) are studying a completely ineffective intergroup contact intervention, and (b) non-randomly assign low-prejudice people to the intergroup contact condition and high-prejudice people to the control condition. In a scenario like this, the researcher will, of course, find that the prejudice was lower in the intergroup contact condition. However, this is not a true effect of the contact intervention, but rather a spurious effect of non-random assignment. Now imagine repeating this across many studies and then performing a meta-analysis. The meta-analyst would find impressive evidence of an intergroup contact effect, but this is simply driven by systematic non-random assignment. Once again: you put garbage in, you get garbage out.

To mitigate this problem, meta-analysts often exclude studies that may be affected by within-study bias. For example, @paluck2019contact excluded nonrandomized studies to avoid concerns about confounding. After data have been collected, meta-analysts often also qualitatively assess studies' risks of bias using established rating tools [@art]. Doing so allows the meta-analyst to communicate just how much within-study bias there may be. @paluck2019contact did not use this tool, but they could have used it to communicate for example, the extent to which participants may have differentially dropped out of the study. Meta-analysts also often conduct sensitivity analyses that examine how much meta-analysis results change when excluding certain types of studies [@art]. For example, if nonrandom assignment is a concern, a meta-analysts may run the analyses with and without studies using nonrandom assignment in order to determine if including these studies changes the meta-analysis results.

<!-- It would be nice to show the reader an example of a risk of bias rating scale. Doing so would also help clarify what types of within-study biases meta-analysts are typically concerned about. https://drive.google.com/file/d/1Q4Fk3HCuBRwIDWTGZa5oH11OdR4Gbhdo/view-->

### Across-study biases

Across-study biases refer to behaviors like researchers selecting reporting certain types of findings (*selective reporting*) or selectively publishing certain types of findings (*publication bias*; see below accident report). Often, these across-study biases favor statistically significant positive results, which means the meta-analysis of the available results will be inflated. For example, if researchers publish only the studies that yield statistically significant positive results and hide the studies that don't, statistically combining the published studies via meta-analysis will obviously lead to exaggerated effect size estimates. Bias in, bias out--garbage in, garbage out.

::: accident-report
🔬 Accident Report: Quantifying publication bias in the social sciences

In 2014, @franco2014 and colleagues examined the population of 221 studies conducted through a funding initiative that helps researchers run experiments on nationally-representative samples in the U.S. First, Franco and colleagues examined the records of these studies to determine whether the researchers found statistically significant results, a mixture of statistically significant and nonsignificant results, or only nonsignificant results. Then, Franco and colleagues examined the likelihood that these results were published in the scientific literature.

What results do you think were most likely to be published? If you guessed "significant results" you have a good intuition about publication bias. Over 60% of studies with statistically significant results were published, compared to the mere 25% of studies that produced only statistically non-significant results. 
:::

Like within-study biases, meta-analysts often try to mitigate across-study biases by being careful about what studies make it into the meta-analysis. Meta-analysts don't only want to capture high-profile, published studies on their effect of interest, but also studies published in low-profile journals and the so-called "gray literature" (i.e., unpublished dissertations and theses; @lefebvre2019searching\].[^5]

[^5]: Evidence is mixed regarding whether including gray literature actually reduces across-study biases in meta-analysis [@tsuji2020addressing; @sapbe], but it is still common practice to try to oinclude this literature.

There are also statistical methods to help assess how robust the results may be to across-study biases. Among the most popular tools to assess and correct for publication bias is the **funnel plot** [@duval2000trim; @egger1997bias], a graph relating the meta-analyzed studies' point estimates to some measure of their precision, such as sample size or standard error. Here is an example of a type of funnel plot [@sapb] for a simulated meta-analysis of 100 studies with no publication bias:

<!-- MM: I used a type of enhanced funnel here that I believe helps visualize publication bias better than standard funnels. Mike, up to you if you want regular funnels instead. I've included commented code for those as well. I didn't describe the purpose of the grey diamonds for now. Text snippet if we decide to briefly mention that: "the grey diamonds represent worst-case point estimate within only the studies with $p \ge 0.05$ or negative estimates." -->

<!-- NC: I like the funnel plot, but it keeps duplicating the plots for some reason" -->


```{r meta-funnel-unbiased, fig.cap = "Significance funnel plot for a meta-analysis simulated to have no publication bias. Orange points: studies with $p < 0.05$ and positive estimates. Grey points: studies with $p$ $\\ge$ $0.05$ or negative estimates. Black diamond: random-effects estimate of $\\widehat{\\mu}$ within all studies."}
# simulate meta with publication bias, but keep all studies
set.seed(451)
d.all = sim_data2( data.frame( k = 100,
                            per.cluster = 1,
                            mu = .5,
                            V = 1,
                            V.gam = 0,  # no clustering
                            sei.min = 0.05,
                            sei.max = 3,
                            true.dist = "norm",
                            SE.corr = FALSE,
                            select.SE = FALSE,
                            eta = 10  # set publication bias
),
keep.all.studies = TRUE )  

# published studies only
dp = d.all %>% filter(publish == TRUE)

meta.all = rma(yi = yi,
            vi = vi,
            data = d.all,
            method = "REML",
            knha = TRUE)

meta.NA = rma(yi = yi,
            vi = vi,
            data = d.all %>% filter(pval > 0.05 | yi < 0),
            method = "REML",
            knha = TRUE)

significance_funnel(yi = meta.all$yi,
                    vi = meta.all$vi,
                    favor.positive = TRUE,
                    plot.pooled = TRUE,
                    est.all = meta.all$b,
                    est.N = meta.NA$b)
# scale_x_continuous( breaks = seq(-2.5, 3.5, 0.5))

# alternative: standard funnel without contour enhancement
# MM considers less preferable. NC concurs.
# funnel(meta.all, 
#        xlab = "Standardized mean difference")
```

Notice that larger studies (those with smaller standard errors) cluster more closely around the mean of `r round(meta.all$b, digits)` than do smaller studies, but large and small studies alikehave point estimates centered around the mean. That is, the funnel plot is symmetric. In contrast, a funnel plot might look asymmetric. Here is what happens to our hypothetical meta-analysis if all studies with $p<0.05$ and positive estimates are published, but only 10% of studies with $p \ge 0.05$ or with negative estimates are published:

```{r meta-funnel-biased, fig.cap = "Significance funnel plot for the same simulated meta-analysis after publication bias has occurred. Orange points: studies with $p < 0.05$ and positive estimates. Grey points: studies with $p$ $\\ge$ $0.05$ or negative estimates. Black diamond: random-effects estimate of $\\widehat{\\mu}$ within all studies."}
meta.p = rma(yi = yi,
            vi = vi,
            data = dp,
            method = "REML",
            knha = TRUE)

meta.p.NA = rma(yi = yi,
            vi = vi,
            data = dp %>% filter(pval > 0.05 | yi < 0),
            method = "REML",
            knha = TRUE)

significance_funnel(yi = meta.p$yi,
                    vi = meta.p$vi,
                    favor.positive = TRUE,
                    plot.pooled = TRUE,
                    est.all = meta.p$b,
                    est.N = meta.p.NA$b) 

#p2 + scale_x_continuous( breaks = seq(-1, 3.5, 0.5) )
```


Notice that the introduction of publication has dramatically inflated the pooled estimate from `r round(meta.all$b, digits)` to `r round(meta.p$b, digits)`.[^8] Also, there appears to be a correlation between studies' estimates and their standard errors, such that smaller studies tend to have larger estimates than do larger studies. This is often called *funnel plot asymmetry*.

Several popular statistical methods, such as Trim-and-Fill [@duval2000trim] and Egger's regression [@egger1997bias] are designed to quantify funnel plot asymmetry. However, one limitation is that funnel plot asymmetry is not always representative of publication bias. Indeed, sometimes funnel plot asymmetry is driven by  genuine differences in the effects being studied in small and large studies [@egger1997bias; @lau2006case]. For example, in a meta-analysis of intervention studies, if the most effective interventions are also the most expensive or difficult to implement, these highly effective interventions might be used primarily in the smallest studies. Thus, funnel plot methods may be indicative of publication bias--but they may more simply driven by small-study effects [@smt].[^14] For these reasons, assessments of publication bias in meta-analysis should rely not only on funnel plots [@smt]. There are numerous other methods that can be applied as well, such as **selection models**.[^15] These models can detect other forms of publication bias that funnel plots may not detect, such as publication bias that favors significant results.

[^14]: Essentially, funnel plots and most related methods can detect publication bias in which (1) small studies with large positive point estimates are more likely to be published than small studies with small or negative point estimates; and (2) the largest studies are published regardless of the magnitude of their point estimates. Funnel plots may not detect publication bias that favors significant results. For more detail on these points, see @smt.

You may also have heard of "$p$-methods" to detect across-study biases such as $p$-curve and $p$-uniform [@simonsohn2014p; @simonsohn2014b; @van2015meta]. These methods essentially assess whether the significant $p$-values "bunch up" just under 0.05, which is taken to indicate publication bias. These methods are increasingly popular in psychology and have merits. However, it is important to note that these methods are actually simplified versions of selection models [e.g., @hedges1984estimation] that work only under considerably more restrictive settings than do the original selection models [for example, when there is not heterogeneity across studies; @mcshane2016adjusting]. For this reason, it is usually (although not always) better to use selection models in place of the more restrictive $p$-methods.

[^15]: High-level overviews of selection models are given in @mcshane2016adjusting and @smt. For more methodological detail, see @hedges1984estimation, @iyengar1988, and @vevea1995. For a tutorial on fitting and interpreting selection models, see @smt.

#### Applied example
In Paluck and colleagues' meta-analysis, they used a regression-based approach to assess and correct for publication bias. This approach provided significant evidence of a relationship between the standard error and effect size (i.e., evidence of an asymmetric funnel plot). This asymettric funnel plot, of course, could be driven by small study effects, but it may be indicative of publication bias. Paluck and colleague subsequently used this same regression-based approach to try to correct for potential  publication bias. Results from this model indicated that the bias-corrected effect size estimate was close to zero. Consequently, Paluck and colleagues concluded that publication bias may be a problem. In other words, even though all studies estimated that intergroup contact decreased prejudice, it is possible that there are studies that did not find this (or found that intergroup contact increased prejudice).

Taken together, Paluck and colleagues' use of meta-analysis provided several important insights that would have been easy to miss in a non-quantitative review:
1. Despite a preponderance of non-significant findings, real-world intergroup contact interventions are estimated to significant decrease prejudice by `r round(as.numeric(re.m$b), 2)` standard deviations.
2. There is significant heterogeneity in intergroup contact effects, suggesting that there are important moderators of the effectiveness of these interventions.
3. Publication bias is a concern, suggesting the need for follow-up research that will be published regardless of the outcome.

::: accident-report
⚠️ Garbage in, garbage out? Meta-analyzing bad research (Coles et al. 2019)

You may have heard that Botox can help eliminate wrinkles. But some researchers have also suggested that it may help treat clinical depression when used to paralyze the muscles associated with frowning. As crazy as they may sound, a quick examination of the literature would lead many to conclude that this treatment works. Studies that randomly assign depressed patients to either receive Botox injections or saline injections do indeed find that Botox recipients exhibit decreases in depression. And when you combine all available evidence in a meta-analysis, you find that this difference is quite large: $\widehat{d}$ = 0.83, 95% CI [0.52, 1.14].

However, @coles2019does pointed out that there is a problem with within-study bias. Participants are not supposed to know whether they have been randomly assigned to receive Botox or a control saline injections. However, only one of these treatments leads the upper half of your face to be paralyzed, and after a couple of weeks you're likely to figure out whether you received the Botox treatment or control saline injection. Thus, it is possible that the apparent effect of Botox on depression is actually an effect of placebo. The meta-analytic conclusions are potentially undermined by within-study bias.

@coles2019does also found evidence of between-study bias. When coding the effect sizes in the literature, they found that 51% of the outcomes measured were not reported by the study authors. For example, researchers may have collected two measures of depression, but only reported one in the manuscript. This raises concerns about selective reporting: that researchers examining the effects of Botox on depression are only reporting the outcomes that demonstrate an effect, while hiding away the outcomes that do not. In this scenario, any meta-analytic conclusions are potentially undermined by between-study bias.

@coles2019does provides a great example of the "garbage in, garbage out" problem we alluded to throughout this chapter. If within- and between-study bias is not properly mitigated, it is difficult to conclude make valid inferences in a meta-analysis.
:::

<!-- ## Summary -->

::: exercise
Imagine that you read the following result in the abstract of a meta-analysis: "In 83 randomized studies of middle school children, replacing one hour of class time with mindfulness meditation significantly improved standardized test scores (standardized mean difference $\widehat{\mu} = 0.05$; 95% confidence interval: [$0.01, 0.09$]; $p<0.05$)." Why is this a problematic way to report on meta-analysis results? Suggest a better sentence to replace this one.

As you read the rest of the meta-analysis, you find that the authors conclude that "These findings demonstrate robust benefits of meditation for children, suggesting that test scores improve even when the meditation is introduced as a replacement for normal class time." You recall that the heterogeneity estimate was $\widehat{\tau} = 0.90$. Do you think that this result regarding the heterogeneity tends to support, or rather tends to undermine, the concluding sentence of the meta-analysis? Why?

What kinds of within-study biases would concern you in this meta-analysis? How might you assess the credibility of the meta-analyzed studies and of the meta-analysis as whole in light of these possible biases?
:::

::: exercise
Imagine you conduct a meta-analysis on a literature in which statistically significant results in either direction are much more likely to be published that nonsignificant results. Draw the funnel plot you would expect to see. Is the plot funnel symmetric or asymmetric?
:::

::: exercise
Why do you think small studies receive more weight in random-effects meta-analysis than in fixed-effects meta-analysis? Can you see why this is true mathematically based on the equations given above, and can you also explain the intuition in simple language?
:::

